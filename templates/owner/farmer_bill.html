{% extends 'home/base.html' %}
{% block head %}
{% endblock head %}
{% block content %}
{% include 'include/alert.html' %}
<div>
    welcome - {{shope.owner_name}}
</div>

{% include 'include/owner/owner_menu.html' %}

<style>
    .farmer_detail{
        width: 80%;
        padding: 10px;
        margin: 0 auto;
    }
    .flex{
        display: flex;
        gap: 10px;
        justify-content: center;
    }
    .farmer_name{
        justify-content: space-between;
        input{
            width: 300px;
        }
    }
    .containt_bill_box{
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 80%;
        padding: 10px;
        margin: 0 auto;
        .containt_box{            
            display: grid;
            grid-template-columns: 2fr 2fr;
            gap: 10px;
            background-color: rgb(189, 255, 255);
            padding: 2px;
            align-items: center;
            border-radius: 5px;
            padding-left: 10px;
        }
        input{
            border: 1px solid black;
            width: 100%;
        }
    }
</style>

<div class="farmer_detail">
    <form method="POST">    {% csrf_token %}
        <div class="farmer_name flex">
            <div><input width="100%" oninput="farmer_check()" id="farmer_name" value="{{farmer.name}}" name="name" type="text" class="form-control" placeholder="शेतकऱ्याचे नाव" required></div>
            {% if selected_farmer_status != 0 %}<div><a href="/owner/farmer_bill/" class="text-danger"><b>X</b></a></div>{% endif %}
        </div>
        <input oninput="farmer_check()" id="farmer_add" name="address" type="text" value="{{farmer.address}}" class="form-control mt-2" placeholder="पत्ता" required>
        <div class="flex" style="justify-content: space-between;">
            <div><input oninput="farmer_check(), check_number()" id="farmer_mobile" value="{{farmer.mobile}}" name="mobile" type="text" class="form-control mt-2" placeholder="मोबाइल नंबर " required></div>
            {% if selected_farmer_status == 0 %}<div id="add_farmer_btn"><button type="submit" class="btn btn-primary mt-2" name="add_farmer">जतन करा</button></div>{% endif %}
        </div>
    </form>
</div>
<div id="farmer_result"></div>

<div class="containt_bill_box">
    <div class="containt_box">
        <div><label for="vehicale_number">गाडी नं.</label></div>
        <div><input type="number" name="vehicale_number" id="vehicale_number" class="form-control" required></div>
    </div>

    <div class="containt_box">
        <div><label for="weight">मालाचे वजन :</label></div>
        <div><input type="number" name="weight" oninput="add_empty_box('empty_box', 'empty_box_weight'),add_wasteage('empty_box_weight','wasteage','wasteage_weight')" id="weight" class="form-control" required></div>
    </div>
    
    <div class="containt_box">
        <div><label for="empty_box">मोकळे बॉक्स वजा :</label></div>
        <div><input type="number" name="empty_box" oninput="add_empty_box('empty_box', 'empty_box_weight')" id="empty_box" class="form-control" required></div>
    </div>
    
    <div class="containt_box">
        <div><label for="weight">मालाचे वजन :</label></div>
        <div><input type="number" id="empty_box_weight" class="form-control" readonly></div>
    </div>
    
    <div class="containt_box">
        <div><label for="wasteage">वेस्टेज :</label></div>
        <div><input type="number" name="wasteage" oninput="add_wasteage('empty_box_weight','wasteage','wasteage_weight')" id="wasteage" class="form-control" required></div>
    </div>
        
    <div class="containt_box">
        <div><label for="weight">मालाचे वजन :</label></div>
        <div><input type="number" id="wasteage_weight" class="form-control" readonly></div>
    </div>
    
    <div class="containt_box">
        <div><label for="danda_weight">दांडा वजन :</label></div>
        <div><input type="number" name="danda_weight" id="danda_weight" class="form-control" readonly></div>
    </div>
    
    <div class="containt_box">
        <div><label for="total_weight">एकुण मालाचे वजन :</label></div>
        <div><input type="number" name="total_weight" id="total_weight" class="form-control" readonly></div>
    </div>
    
    <div class="containt_box">
        <div><label for="prise">दर :</label></div>
        <div><input type="number" oninput="calculate_prise()" name="prise" id="prise" class="form-control" required></div>
    </div>
    
    <div class="containt_box">
        <div><label for="amount">रक्कम :</label></div>
        <div><input type="number" name="amount" id="amount" class="form-control" required></div>
    </div>
    
    <div class="containt_box">
        <div><label for="labor">लेबर वजा :</label></div>
        <div><input type="number" name="labor" id="labor" class="form-control" required></div>
    </div>
    
    <div class="containt_box">
        <div><label for="advance">अॅडव्हांस वजा</label></div>
        <div><input type="number" name="advance" id="advance" value="0" class="form-control" required></div>
    </div>
    
    <div class="containt_box">
        <div><label for="total_amount">एकुण रक्कम</label></div>
        <div><input type="number" name="total_amount" id="total_amount" value="0" class="form-control" required></div>
    </div>

</div>

<script>
    function add_empty_box(input_id, add_input_id){
        from_input = document.getElementById('weight').value;
        input = document.getElementById(input_id).value;
        a = from_input - input
        document.getElementById(add_input_id).value = a
    }
    function add_wasteage(old_weight,wasteage_input,add_input){
        from_input = document.getElementById(old_weight).value;
        input = document.getElementById(wasteage_input).value;
        console.log(a)
        a = Number(from_input) + Number(input)
        document.getElementById(add_input).value = a
        danda_weight = (a / 100) * 8
        document.getElementById('danda_weight').value = danda_weight
        
        total_weight = a + danda_weight
        document.getElementById('total_weight').value = total_weight
    }
    function calculate_prise(){
        total_weight = document.getElementById('total_weight').value;
        prise = document.getElementById('prise').value;
        amount = prise * Math.floor(total_weight)
        document.getElementById('amount').value=amount
        
        labor_amount = total_weight * 0.4 
        labor_amount = labor_amount.toFixed(0)
        document.getElementById('labor').value = labor_amount
    }
    
    function farmer_check(){
    name = document.getElementById('farmer_name').value;
    address = document.getElementById('farmer_add').value;
    mobile = document.getElementById('farmer_mobile').value;
    $.ajax({
        url: "{% url 'farmer_check' %}",
        method: "GET",
        data:{
            name:name,
                    address:address,
                    mobile:mobile,
                    shope_id:'{{shope.id}}'
                },
                    success: function(res){
                        $("#farmer_result").html(res.t)
                    }
            })
        }
</script>
{% endblock content %}